apply plugin: 'java-gradle-plugin'
apply plugin: 'kotlin'

group artifactGroup
version artifactVersion

dependencies {
    compileOnly gradleApi()
    implementation project(':package-identifier-annotations')

    implementation deps.android.gradlePlugin
    implementation deps.kotlin.stdlib
    implementation deps.kotlinpoet
    implementation 'junit:junit:4.12'
}

sourceCompatibility = "1.7"
targetCompatibility = "1.7"

sourceSets.main.java.srcDir "$buildDir/generated/source/package-identifier"

task pluginVersion {
    def outputDir = file("$buildDir/generated/source/package-identifier/")

    inputs.property 'version', version
    outputs.dir outputDir

    doLast {
        def versionFile = file("$outputDir/com/trello/identifier/Version.kt")
        versionFile.parentFile.mkdirs()
        versionFile.text = """
// Generated file. Do not edit!
package com.trello.identifier
val VERSION = "${project.version}"
"""
    }
}

tasks.getByName('compileKotlin').dependsOn('pluginVersion')
